{"ast":null,"code":"import { Map, Geolocation } from 'ol';\nimport TileLayer from 'ol/layer/Tile';\nimport VectorSource from 'ol/source/Vector';\nimport GeoJSON from 'ol/format/GeoJSON';\nimport { bbox as bboxStrategy } from 'ol/loadingstrategy';\nimport VectorLayer from 'ol/layer/Vector';\nimport Select from 'ol/interaction/Select';\nimport XYZSource from 'ol/source/XYZ';\nimport { baseLayerUrl, geoserverWfsUrl, view, trackFeature, proxyUrls } from './MapConfig';\nimport { selectedStyle, defaultStyle, activeStyle } from './MapStyles';\nexport class MapUtils {\n  static createBaseLayer() {\n    const xyzURL = baseLayerUrl;\n    const baseSource = new XYZSource({\n      url: xyzURL\n    });\n    const baseLayer = new TileLayer({\n      source: baseSource\n    });\n    return baseLayer;\n  }\n\n  static createMap(target) {\n    const baseLayer = this.createBaseLayer();\n    const map = new Map({\n      target: target,\n      layers: [baseLayer],\n      view: view\n    });\n    return map;\n  } //creates a vector source based on a publised geoserver layer\n\n\n  static createSource(typename) {\n    const source = new VectorSource({\n      format: new GeoJSON(),\n      url: function (extent) {\n        return `${geoserverWfsUrl}\n                &request=GetFeature&typename=${typename}\n                &outputFormat=application/json\n                &srsname=EPSG:3857&bbox=${extent.join(',')},EPSG:3857`;\n      },\n      strategy: bboxStrategy\n    });\n    return source;\n  } //creates a vector source fom postgres table\n\n\n  static createPgSource(url) {\n    const source = new VectorSource({\n      format: new GeoJSON(),\n      features: new GeoJSON().readFeatures(this.getGeojson(proxyUrls[0]))\n    });\n    return source;\n  } //creates a vector layer based on a vector source from a published geoserver layer\n\n\n  static createVector(typename) {\n    const vectorSource = this.createSource(typename);\n    const vectorLayer = new VectorLayer({\n      source: vectorSource,\n      extent: vectorSource.getExtent(),\n      style: defaultStyle\n    });\n    vectorLayer.setMinZoom(16);\n    return vectorLayer;\n  } //creates a vector layer based on a vector source from a published geoserver layer\n\n\n  static async getGeojson(url) {\n    const response = await fetch(url, {\n      method: 'GET'\n    });\n    return await response.json();\n  } //creates select interaction\n\n\n  static createSelect() {\n    const select = new Select({\n      style: selectedStyle\n    });\n    return select;\n  }\n\n  static createGeolocation(map) {\n    const geolocation = new Geolocation({\n      tracking: true,\n      projection: 'EPSG:3857'\n    });\n    trackFeature.setGeometryName('geom');\n    geolocation.on('change', function () {\n      console.log('Change detected, push coordiantes to LineStringArray.');\n      let coordinate = geolocation.getPosition();\n      let track = trackFeature.getGeometry();\n      track.appendCoordinate(coordinate);\n      view.setCenter(track.getFirstCoordinate());\n    });\n    let trackLayer = new VectorLayer({\n      source: new VectorSource({\n        features: [trackFeature]\n      }),\n      style: activeStyle\n    });\n    map.addLayer(trackLayer);\n    alert('Tracking started. If your position changes, map will zoom to your current location.');\n    return geolocation;\n  }\n\n  static removeLastLayer(map) {\n    const layers = map.getLayers().getArray();\n    const layer = layers[layers.length - 1];\n    layer.getSource().clear();\n  }\n\n}","map":{"version":3,"sources":["C:/Users/Fabi/Documents/dashboard_client/src/utils/MapUtils.tsx"],"names":["Map","Geolocation","TileLayer","VectorSource","GeoJSON","bbox","bboxStrategy","VectorLayer","Select","XYZSource","baseLayerUrl","geoserverWfsUrl","view","trackFeature","proxyUrls","selectedStyle","defaultStyle","activeStyle","MapUtils","createBaseLayer","xyzURL","baseSource","url","baseLayer","source","createMap","target","map","layers","createSource","typename","format","extent","join","strategy","createPgSource","features","readFeatures","getGeojson","createVector","vectorSource","vectorLayer","getExtent","style","setMinZoom","response","fetch","method","json","createSelect","select","createGeolocation","geolocation","tracking","projection","setGeometryName","on","console","log","coordinate","getPosition","track","getGeometry","appendCoordinate","setCenter","getFirstCoordinate","trackLayer","addLayer","alert","removeLastLayer","getLayers","getArray","layer","length","getSource","clear"],"mappings":"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","sourcesContent":["\r\nimport { Map, Geolocation } from 'ol';\r\nimport TileLayer from 'ol/layer/Tile';\r\nimport VectorSource from 'ol/source/Vector';\r\nimport GeoJSON from 'ol/format/GeoJSON';\r\nimport { bbox as bboxStrategy } from 'ol/loadingstrategy';\r\nimport VectorLayer from 'ol/layer/Vector';\r\nimport Select from 'ol/interaction/Select';\r\nimport XYZSource from 'ol/source/XYZ';\r\nimport { baseLayerUrl, geoserverWfsUrl, view, trackFeature, proxyUrls } from './MapConfig';\r\nimport { selectedStyle, defaultStyle, activeStyle } from './MapStyles';\r\nimport LineString from 'ol/geom/LineString';\r\n\r\nexport class MapUtils {\r\n    static createBaseLayer() {\r\n        const xyzURL: string = baseLayerUrl;\r\n        const baseSource: XYZSource = new XYZSource({\r\n            url: xyzURL\r\n        });\r\n        const baseLayer: TileLayer = new TileLayer({\r\n            source: baseSource\r\n        });\r\n\r\n        return baseLayer;\r\n    }\r\n\r\n    static createMap(target: string) {\r\n        const baseLayer: TileLayer = this.createBaseLayer();\r\n        const map: Map = new Map({\r\n            target: target,\r\n            layers: [baseLayer],\r\n            view: view\r\n        });\r\n        return map;\r\n    }\r\n    //creates a vector source based on a publised geoserver layer\r\n    static createSource(typename: string) {\r\n        const source: VectorSource = new VectorSource({\r\n            format: new GeoJSON(),\r\n            url: function (extent: number[]) {\r\n                return `${geoserverWfsUrl}\r\n                &request=GetFeature&typename=${typename}\r\n                &outputFormat=application/json\r\n                &srsname=EPSG:3857&bbox=${extent.join(',')},EPSG:3857`;\r\n            },\r\n            strategy: bboxStrategy,\r\n        });\r\n        return source;\r\n    }\r\n\r\n    //creates a vector source fom postgres table\r\n    static createPgSource(url?: string) {\r\n        const source: VectorSource = new VectorSource({\r\n            format: new GeoJSON(),      \r\n            features: new GeoJSON().readFeatures(this.getGeojson(proxyUrls[0]))      \r\n        });\r\n        return source;\r\n    }\r\n    //creates a vector layer based on a vector source from a published geoserver layer\r\n    static createVector(typename: string) {\r\n        const vectorSource: VectorSource = this.createSource(typename);\r\n        const vectorLayer: VectorLayer = new VectorLayer({\r\n            source: vectorSource,\r\n            extent: vectorSource.getExtent(),\r\n            style: defaultStyle,\r\n        });\r\n        vectorLayer.setMinZoom(16)\r\n        return vectorLayer;\r\n    }\r\n    //creates a vector layer based on a vector source from a published geoserver layer\r\n    static async getGeojson(url:string) {\r\n        const response = await fetch(url, {\r\n            method: 'GET',\r\n        });\r\n        return await response.json();\r\n    }\r\n\r\n    //creates select interaction\r\n    static createSelect(): Select {\r\n        const select: Select = new Select({\r\n            style: selectedStyle\r\n        });\r\n        return select;\r\n    }\r\n\r\n    static createGeolocation(map: Map | null): Geolocation {\r\n        const geolocation = new Geolocation({\r\n            tracking: true,\r\n            projection: 'EPSG:3857',\r\n        });\r\n        trackFeature.setGeometryName('geom');\r\n        geolocation.on('change', function () {\r\n            console.log('Change detected, push coordiantes to LineStringArray.')\r\n            let coordinate: number[] = geolocation.getPosition();\r\n            let track: LineString = trackFeature.getGeometry() as LineString\r\n            track.appendCoordinate(coordinate)\r\n            view.setCenter(track.getFirstCoordinate());\r\n        });\r\n        let trackLayer = new VectorLayer({\r\n            source: new VectorSource({\r\n                features: [trackFeature]\r\n            }),\r\n            style: activeStyle\r\n        });\r\n        map!.addLayer(trackLayer)\r\n        alert('Tracking started. If your position changes, map will zoom to your current location.')\r\n        return geolocation;\r\n    }\r\n\r\n    static removeLastLayer(map: Map | null) {\r\n        const layers = map!.getLayers().getArray();\r\n        const layer = layers[layers.length - 1] as VectorLayer;\r\n        layer.getSource().clear();\r\n    }\r\n\r\n}"]},"metadata":{},"sourceType":"module"}